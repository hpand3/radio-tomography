<!DOCTYPE html>
<html>
<head>
	<title>3D tomography</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
	<style>
		body { margin: 0; }
		canvas { width: 100%; height: 100%; background-color: white; }
	</style>

</head>

<body>

	<script type="text/javascript" src="./three.js"></script>
	<script type="text/javascript" src="js/TrackballControls.js"></script>
	<script>

	// Dimensions
	var dim = {x:3 , y:3 , z:3};

	// Scene
	var scene = new THREE.Scene();

	// Camera
	var camera = new THREE.PerspectiveCamera( 50, window.innerWidth/window.innerHeight, 0.1, 1000 );

	// Renderer
	var renderer = new THREE.WebGLRenderer();
	renderer.setSize( window.innerWidth, window.innerHeight );
	renderer.setClearColor (0xe8e8e8, 1);
	document.body.appendChild( renderer.domElement );

	// Init vars
	var cubeGeo = new THREE.BoxGeometry( 1, 1, 1 );
	var wireGeo = new THREE.EdgesGeometry( cubeGeo );
	var wireMat = new THREE.LineBasicMaterial( { color: 0x000000 } );

	// Mesh group
	var cubeGroup = new THREE.Group();
	var wireGroup = new THREE.Group();

	// Contains all the cubes
	var superCube = new Array(new Array(new Array()));
	var superCubeWire = new Array(new Array(new Array()));

	for(posx = 0; posx < dim["x"]; posx++) {
		for(posy = 0; posy < dim["y"]; posy++) {
			for(posz = 0; posz < dim["z"]; posz++) {
				// Create objects
				var cubeMat = new THREE.MeshBasicMaterial( { color: 
					0xe00b0b, transparent:true, opacity:0.6 } );
				var cube = new THREE.Mesh( cubeGeo, cubeMat );
				var wireframe = new THREE.LineSegments( wireGeo, 
					wireMat );

				// Set cube position
				cube.position.x = posx;
				cube.position.y = posy;
				cube.position.z = posz;

				// Set wireframe position
				wireframe.position.x = posx;
				wireframe.position.y = posy;
				wireframe.position.z = posz;

				// Add to list
				superCube[posx, posy, posz] = cube;
				superCubeWire[posx, posy, posz] = wireframe;
				
				// Add to group
				cubeGroup.add( cube );
				wireGroup.add( wireframe );
			}
		}
	}

	scene.add(cubeGroup);
	scene.add(wireGroup);

	var setColor = function(cube, color) {
		cube.material.color = new THREE.Color("hsl(" + color + ", 100%, 50%)");
	};

	var percentToColor = function(percent, start, end) {
		var ratio = percent/100;
		var scale = (end - start) * ratio;
		var color = scale + start;
		return color;
	}

	// Change color
	for(num = 0; num < cubeGroup.children.length; num++) {
		setColor(cubeGroup.children[num], percentToColor((num/27)*100,240,0));
	}

	camera.position.z = 10;

	var setColor = function(cube, color) {
		cube.material.color = new THREE.Color(color);
	};

	var render = function () {
		requestAnimationFrame( render );

		cubeGroup.rotation.x += 0.01;
		cubeGroup.rotation.y += 0.01;
		wireGroup.rotation.x += 0.01;
		wireGroup.rotation.y += 0.01;

		renderer.render(scene, camera);
	};

	render();
	</script>

</body>

</html>
